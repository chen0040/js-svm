var jssvm=jssvm||{};!function(t){t.small=function(){for(var t=.5,r=1*t+1;r>1;)r=1*(t/=2)+1;return 2*t*2},t.quickSort=function(r,i){t._quickSort(r,0,r.length-1,i)},t._quickSort=function(r,i,s,a){if(!(i>=s)){var o=t._partition(r,i,s,a);t._quickSort(r,i,o-1,a),t._quickSort(r,o+1,s,a)}},t._partition=function(r,i,s,a){for(var o=r[i],h=i,e=s+1;;){for(;a(o,r[++h])>0&&!(h>=s););for(;a(o,r[--e])<0&&!(e<=i););if(h>=e)break;t._exchange(r,h,e)}return t._exchange(r,i,e),e},t._exchange=function(t,r,i){var s=t[r];t[r]=t[i],t[i]=s},t.deltaStep=function(t){var r=Math.sqrt(this.small()),i=Math.max(1,Math.abs(t)),s=Math.max(0,Math.abs(r*i));return t<0&&(s=-s),s},t.dotProduct=function(t,r){for(var i=0,s=r.length,a=0;a<s;++a)i+=t[a]*r[a];return i};var r=function(t){(t=t||{}).iterations||(t.iterations=100),t.alpha||(t.alpha=1e-4),t.C||(t.C=1),t.trace||(t.trace=!1),this.iterations=t.iterations,this.alpha=t.alpha,this.C=t.C,this.trace=t.trace};r.prototype.fit=function(t){this.dim=t[0].length;for(var r=t.length,i=[],s=[],a=0;a<r;++a){var o=t[a],h=[],e=o[o.length-1];h.push(1);for(var n=0;n<o.length-1;++n)h.push(o[n]);i.push(h),s.push(e)}this.theta=[];for(f=0;f<this.dim;++f)this.theta.push(0);for(var c=0;c<this.iterations;++c){for(var u=this.grad(i,s,this.theta),f=0;f<this.dim;++f)this.theta[f]=this.theta[f]-this.alpha*u[f];this.trace&&console.log("cost: "+this.cost(i,s,this.theta))}return{theta:this.theta,cost:this.cost(i,s,this.theta),config:{alpha:this.alpha,lambda:this.lambda,iterations:this.iterations,trace:this.trace}}},r.prototype.smallStep=function(r,i){return t.deltaStep(r[i])},r.prototype.grad=function(t,r,i){for(var s=[],a=this.cost(t,r,i),o=0;o<this.dim;++o){var h=this.smallStep(i,o),e=i[o];i[o]+=h;var n=this.cost(t,r,i);i[o]=e,s.push((n-a)/2)}return s},r.prototype.cost=function(r,i,s){for(var a=r.length,o=0,h=0;h<a;++h){var e=r[h],n=i[h];o+=this.C*(n*this.cost1(e,n,s)+(1-n)*this.cost0(e,n,s))}return o+=t.dotProduct(s,s)/2,o/=a},r.prototype.cost1=function(r,i,s){var a=t.dotProduct(r,s);return a>1?0:1-a},r.prototype.cost0=function(r,i,s){var a=t.dotProduct(r,s);return a<-1?0:1+a},r.prototype.transform=function(r){if(r[0].length){for(var i=[],s=0;s<r.length;++s){var a=this.transform(r[s]);i.push(a)}return i}var o=[];o.push(1);for(var h=0;h<r.length;++h)o.push(r[h]);return t.dotProduct(o,this.theta)},t.LinearSvm=r;var i=function(r){this.classifier=new t.LinearSvm(r)};i.prototype.fit=function(t){var r=this.classifier.fit(t),i=this.classifier.dim,s=this.classifier.transform(t);this.threshold=null;for(var a=t.length,o=0;o<a;++o)1==t[o][i-1]&&(null==this.threshold||this.threshold>s[o])&&(this.threshold=s[o]);return r},i.prototype.transform=function(t){return this.classifier.transform(t)>this.threshold?1:0},t.BinarySvmClassifier=i}(jssvm),module&&(module.exports=jssvm);